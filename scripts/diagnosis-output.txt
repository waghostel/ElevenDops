============================================================
AUDIO PLAYBACK DIAGNOSIS
============================================================

[CONFIG] CONFIGURATION:
  - USE_GCS_EMULATOR: False
  - USE_MOCK_STORAGE: False
  - GCS_BUCKET_NAME: elevendops-bucket
  - GOOGLE_CLOUD_PROJECT: elevendops-dev
  - USE_FIRESTORE_EMULATOR: False
  - FIRESTORE_DATABASE_ID: elevendops-db
  - FASTAPI_PORT: 8000

[FIRESTORE] FETCHING AUDIO METADATA FROM FIRESTORE:
  [OK] Found 8 audio file(s) in Firestore

  Audio #1:
    - audio_id: 1b04bbbb-43eb-45ae-98b2-e99c02134c83
    - audio_url (stored): audio/1b04bbbb-43eb-45ae-98b2-e99c02134c83.mp3
    - knowledge_id: test_doc
    - doctor_id: dr_demo_001
    - created_at: 2026-01-09 15:05:33.020148+00:00

  Audio #2:
    - audio_id: 4b141115-a326-4ae4-92a0-daa4ebc24e67
    - audio_url (stored): audio/4b141115-a326-4ae4-92a0-daa4ebc24e67.mp3
    - knowledge_id: test_doc
    - doctor_id: dr_demo_001
    - created_at: 2026-01-09 15:05:38.676602+00:00

  Audio #3:
    - audio_id: 59c2d274-7030-45cb-a8bd-ce90cf9f5ce2
    - audio_url (stored): audio/59c2d274-7030-45cb-a8bd-ce90cf9f5ce2.mp3
    - knowledge_id: test_doc
    - doctor_id: dr_demo_001
    - created_at: 2026-01-09 15:05:37.033504+00:00

  Audio #4:
    - audio_id: 8b69d3f1-a0f1-47bb-b46c-15fcd369dd71
    - audio_url (stored): audio/8b69d3f1-a0f1-47bb-b46c-15fcd369dd71.mp3
    - knowledge_id: test_doc
    - doctor_id: dr_demo_001
    - created_at: 2026-01-09 15:04:57.687472+00:00

  Audio #5:
    - audio_id: 9118c3bf-6a5d-4414-af27-6ac1b610a15e
    - audio_url (stored): audio/9118c3bf-6a5d-4414-af27-6ac1b610a15e.mp3
    - knowledge_id: test_doc
    - doctor_id: dr_demo_001
    - created_at: 2026-01-09 15:05:40.575994+00:00

[GCS] VERIFYING GCS FILE EXISTENCE:

  Audio #1 (1b04bbbb-43eb-45ae-98b2-e99c02134c83):
    - Stored URL: audio/1b04bbbb-43eb-45ae-98b2-e99c02134c83.mp3
    - Resolved path: audio/1b04bbbb-43eb-45ae-98b2-e99c02134c83.mp3
    - File exists in GCS: [OK] YES

  Audio #2 (4b141115-a326-4ae4-92a0-daa4ebc24e67):
    - Stored URL: audio/4b141115-a326-4ae4-92a0-daa4ebc24e67.mp3
    - Resolved path: audio/4b141115-a326-4ae4-92a0-daa4ebc24e67.mp3
    - File exists in GCS: [OK] YES

  Audio #3 (59c2d274-7030-45cb-a8bd-ce90cf9f5ce2):
    - Stored URL: audio/59c2d274-7030-45cb-a8bd-ce90cf9f5ce2.mp3
    - Resolved path: audio/59c2d274-7030-45cb-a8bd-ce90cf9f5ce2.mp3
    - File exists in GCS: [OK] YES

[SIGN] TESTING SIGNED URL GENERATION:
  - Original URL: audio/1b04bbbb-43eb-45ae-98b2-e99c02134c83.mp3
  - Signed URL: https://storage.googleapis.com/elevendops-bucket/audio/1b04bbbb-43eb-45ae-98b2-e99c02134c83.mp3?X-Go...
  - Signed URL accessible: [OK] YES
  - Content-Type: audio/mpeg
  - Content-Length: 10911 bytes

[STREAM] TESTING STREAMING ENDPOINT:
  - Stream URL: http://localhost:8000/api/audio/stream/1b04bbbb-43eb-45ae-98b2-e99c02134c83
  - Backend health: [OK] Running
  - Stream response status: 200
  - Content-Type: audio/mpeg
  - Content-Length: 10911 bytes
  [OK] Stream endpoint working correctly!

[TEST] TESTING STREAM_AUDIO METHOD DIRECTLY:
  - stream_audio returned: <class 'generator'>
  - Result is iterable: [OK]
  - First 2 chunks: 10911 bytes

[STRATEGY] VERIFYING URL STRATEGY:
  - Final Processed URL: https://storage.googleapis.com/elevendops-bucket/audio/1b04bbbb-43eb-45ae-98b2-e99c02134c83.mp3?X-Goog-Algorithm=GOOG4-RSA-SHA256&X-Goog-Credential=elevendops-sa%40elevendops-dev.iam.gserviceaccount.com%2F20260112%2Fauto%2Fstorage%2Fgoog4_request&X-Goog-Date=20260112T061816Z&X-Goog-Expires=3600&X-Goog-SignedHeaders=host&X-Goog-Signature=09b03063004d6f3f656e2dda609e3c51c67a674cabb5c19e2969c99357bd4b43db97d9022c62ca82a06684a39a7e215b714c145e30ba728171bd47ffd0f5f38a1e1950b4f715727b73538f1da381c1205f671fca9d7b43ec049fa893695b45fa0ab5b430c17cdd2a18744e7453c3a5445326b793868b2d14a7fee5ea26bf3a71fea4b0945f32f6c0210352648f21baca3c35e285ed5e9182b6396cec83d7606083262581ac4be23c80c63cc9d659e8af39e053535393ce7c8a7b0892175b26a9c5596ee9f2006bf0f828a80e455fd5752984a005a8598eed96f762542b3f66e932dca42a22ecb57b923afe2321547fdd23887d41d47d94569f8d11b529b76827
  - Strategy: [OK] [SIGNED URL] (Service Account detected!)

============================================================
DIAGNOSIS COMPLETE
============================================================
