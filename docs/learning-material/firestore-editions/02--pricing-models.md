# Firestore 計費模型 (Pricing & Billing)

## 關鍵字

- **Count-based (基於次數)**：Standard 版的計費方式，簡單計算讀寫了多少個文件。
- **Unit-based (基於單位)**：Enterprise 版的計費方式，計算處理了多少「資料單位」。
- **KiB (Kibibyte)**：二進位制單位（1 KiB = 1,024 Bytes），GCP 所有的資料處理單位皆以此計算。
- **Tranche (切分單位/起跳價)**：Enterprise 版計算讀寫量時的最小資料區塊（讀取為 4 KiB）。
- **Free Tier (免費額度)**：Google 提供的新手上路免付費額度。

## 學習目標

完成本章節後，您將能夠：

1. 預估應用程式在不同版本下的維運成本
2. 理解「文件次數」與「處理單位」計費的核心差異
3. 理解 **Single-region** 與 **Multi-region** 的價格、可用性與網路成本差異
4. 利用免費額度最大化開發效益

## 步驟說明

### 步驟 1：理解 Standard 版計費（最直覺）

(內容略，保持不變)

### 步驟 2：理解 Enterprise 版計費（精算型）

(內容略，保持不變)

### 步驟 3：選擇區域：Single-region vs Multi-region

在建立資料庫時，您需要選擇資料的物理存放範圍。這會直接影響價格與穩定性。

#### 1. 價格分級 (Geography Tiers)

並非所有單一區域的價格都相同。GCP 通常將區域分為幾個價格等級：

- **最便宜區域 (Low-cost)**：如 **`us-central1` (愛荷華)**、**`us-east1` (南卡羅來納)**。這些區域的電力與土地成本較低，通常是全球定價的最低基準。
- **標準區域**：如 **`asia-east1` (台灣)**、**`europe-west1` (比利時)**。價格通常比美國核心區域貴 **10% - 20%**。
- **高成本區域**：如 **`asia-northeast1` (東京)**、**`australia-southeast1` (雪梨)**。因當地成本極高，單價最貴。

#### 2. 強大優勢：可用性 (SLA)

- **Single-region**：提供 **99.99%** 的可用性。如果整個台灣資料中心斷電，資料庫會暫時無法存取。
- **Multi-region**：提供 **99.999%** 的可用性。即使一個城市發生天災导致機房全毀，另一個城市的機房會立即接手。

#### 3. 隱形金錢陷阱：網路流量 (Network Egress)

- **Single-region**：如果您從這區域傳輸資料到外面的網路，會產生標準的網路流量費。
- **Multi-region**：在同一個多區域範圍內（例如 `nam5` 內的各區域）移動資料，通常是**免費**的。這對於全球分散式的 App 來說反而可能更省錢。

### 步驟 4：善用 Free Tier

#### 我們在做什麼？

查看 Google Cloud 提供的免費額度。

#### 為什麼需要這樣做？

在學習階段，您可以幾乎不花一毛錢實踐所有功能：

- **Firestore Standard 免費額度**：
  - 每天 50,000 次讀取。
  - 每天 20,000 次寫入。
  - 每天 20,000 次刪除。
  - 1 GB 的總儲存量。
- **Cloud Storage 免費額度 (重要限制)**：
  - **僅限特定區域**：`us-east1`、`us-west1`、`us-central1`。
  - 每個帳戶每月 5 GB 儲存空間。

> [!TIP] > **如果您非常在意成本 (Cost-Sensitive)**：選擇 `us-central1` (愛荷華) 是目前全球公認最划算的方案，且能完整享受 Cloud Storage 的免費額度。
> **如果您在意效能 (Performance-Sensitive)**：選擇 `asia-east1` (台灣)，延遲最低，雖然單價稍高但使用者體驗最佳。

## 常見問題 Q&A

### Q1：Enterprise 版會有免費額度嗎？

**答：** 有的。Enterprise 版也有提供對應的 Free units，但計算方式較為複雜，建議參考 GCP 官網的細則。

### Q2：ElevenDops 的音檔會存在 Firestore 嗎？這樣會很貴嗎？

**答：** 不會。音檔（Binary Data）儲存在 Google Cloud Storage (GCS)，Firestore 僅儲存「音檔的 URL」。這樣能確保資料庫運作快速且費用保持在地板價。

### Q3：Multi-region 價格較高，我該選嗎？

**答：** 對於大多數開發中的專案（如 ElevenDops），**建議選 Single-region (如台灣 asia-east1)**。因為它價格較低，且 99.99% 的可用性對於 99% 的應用程式來說已經非常足夠。

## 重點整理

| 概念              | 單價                          | 可用性 (SLA)           | 適用時機                     |
| :---------------- | :---------------------------- | :--------------------- | :--------------------------- |
| **Single-region** | 較低                          | 99.99%                 | 預算有限、使用者集中在某地區 |
| **Multi-region**  | 較高                          | 99.999%                | 企業級關鍵應用、需要極致容災 |
| **次數計費**      | Standard 採用，簡單好懂       | 適合一般 Web/App 開發  |
| **容量計費**      | Enterprise 採用，適合大量數據 | 適合高吞吐量的企業後端 |
| **Free Tier**     | 每日重置的免費額度            | 開發測試必備           |

## 延伸閱讀

- [GCP Firestore Pricing Detail](https://cloud.google.com/firestore/pricing)

---

## 參考程式碼來源

| 檔案路徑                    | 說明                                              |
| :-------------------------- | :------------------------------------------------ |
| `backend/models/schemas.py` | 透過定義精確的 Schema，可以控制文件大小並預估成本 |
