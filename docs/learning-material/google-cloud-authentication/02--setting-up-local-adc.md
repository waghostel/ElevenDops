# æœ¬åœ°é–‹ç™¼ç’°å¢ƒé…ç½® ADC

## é—œéµå­—

- **gcloud CLI**ï¼šGoogle Cloud çš„å‘½ä»¤åˆ—å·¥å…·ã€‚
- **application-default login**ï¼šADC ç‰¹å±¬çš„ç™»å…¥å­å‘½ä»¤ã€‚
- **Quota Project**ï¼šç”¨æ–¼è¨ˆè²»èˆ‡é…é¡é™åˆ¶çš„å°ˆæ¡ˆ IDã€‚

## å­¸ç¿’ç›®æ¨™

å®Œæˆæœ¬ç« ç¯€å¾Œï¼Œæ‚¨å°‡èƒ½å¤ ï¼š

1. ä½¿ç”¨ `gcloud` æŒ‡ä»¤åœ¨æœ¬åœ°æ©Ÿå™¨å•Ÿç”¨ ADCã€‚
2. é©—è­‰ ADC æ˜¯å¦æ­£ç¢ºé‹ä½œã€‚
3. çŸ¥é“ ADC æ†‘è­‰æª”æ¡ˆåœ¨ä¸åŒä½œæ¥­ç³»çµ±ä¸­çš„å„²å­˜ä½ç½®ã€‚

## æ­¥é©Ÿèªªæ˜

### æ­¥é©Ÿ 1ï¼šå®‰è£ä¸¦åˆå§‹åŒ– gcloud CLI

#### æˆ‘å€‘åœ¨åšä»€éº¼ï¼Ÿ

ç¢ºä¿æ‚¨çš„æ©Ÿå™¨ä¸Šå·²ç¶“å®‰è£å¥½ `gcloud` SDKï¼Œä¸¦å®Œæˆäº†åŸºæœ¬çš„èº«åˆ†é©—è­‰ã€‚

#### ç‚ºä»€éº¼éœ€è¦é€™æ¨£åšï¼Ÿ

ADC ä¾è³´ `gcloud` çš„å·¥å…·éˆä¾†ç”Ÿæˆå’Œç®¡ç†é–‹ç™¼è€…æ†‘è­‰ã€‚

#### å‘½ä»¤åˆ—ç¯„ä¾‹

```powershell
# 1. ç™»å…¥ Google Cloud (ç¶²é æˆæ¬Š)
gcloud auth login

# 2. è¨­å®šç›®å‰çš„å°ˆæ¡ˆ
gcloud config set project elevendops-dev-123

# 3. ç²å– ADC æ†‘è­‰ (æœ€é—œéµçš„ä¸€æ­¥)
gcloud auth application-default login
```

### æ­¥é©Ÿ 2ï¼šç†è§£æ†‘è­‰å„²å­˜ä½ç½®

#### æˆ‘å€‘åœ¨åšä»€éº¼ï¼Ÿ

äº†è§£ `gcloud auth application-default login` ä¹‹å¾Œï¼Œç³»çµ±åˆ°åº•ç™¼ç”Ÿäº†ä»€éº¼è®ŠåŒ–ã€‚

#### ç‚ºä»€éº¼éœ€è¦é€™æ¨£åšï¼Ÿ

ç•¶æ‚¨éœ€è¦å°‡æ†‘è­‰æ˜ å°„ (Mount) åˆ° Docker å®¹å™¨æˆ–æ’æŸ¥å•é¡Œæ™‚ï¼Œå¿…é ˆçŸ¥é“æª”æ¡ˆè·¯å¾‘ã€‚

#### ä¸åŒä½œæ¥­ç³»çµ±çš„è·¯å¾‘

| ä½œæ¥­ç³»çµ±        | æ†‘è­‰å„²å­˜è·¯å¾‘                                            |
| --------------- | ------------------------------------------------------- |
| **Windows**     | `%APPDATA%\gcloud\application_default_credentials.json` |
| **Linux / Mac** | `~/.config/gcloud/application_default_credentials.json` |

> [!TIP]
> é€™äº›æª”æ¡ˆåŒ…å«äº†æ‚¨çš„ Access Token è³‡è¨Šï¼Œèƒ½ä»¥æ­¤èº«åˆ†å­˜å– GCPã€‚é™¤éå¿…è¦ï¼ˆå¦‚ Docker æ›è¼‰ï¼‰ï¼Œå¦å‰‡**è«‹å‹¿éš¨æ„ç§»å‹•ã€è¤‡è£½æˆ–å°‡å…¶ä¸Šå‚³åˆ° GitHub**ã€‚

### æ­¥é©Ÿ 3ï¼šé©—è­‰æ©Ÿåˆ¶

#### æˆ‘å€‘åœ¨åšä»€éº¼ï¼Ÿ

å¯«ä¸€æ®µç°¡å–®çš„ Python è…³æœ¬ä¾†æ¸¬è©¦ SDK æ˜¯å¦èƒ½é †åˆ©æŠ“åˆ°èº«åˆ†ã€‚

#### ç¨‹å¼ç¢¼ç¯„ä¾‹

```python
# test_adc.py
from google.auth import default
from google.cloud import storage

# ç²å–é è¨­æ†‘è­‰èˆ‡å°ˆæ¡ˆ ID
credentials, project = default()

if credentials:
    print(f"âœ… æˆåŠŸæ‰¾åˆ°æ†‘è­‰!")
    print(f"å°ˆæ¡ˆ ID: {project}")

    # å˜—è©¦åˆ—å‡º Bucket ä»¥é©—è­‰æ¬Šé™
    client = storage.Client()
    buckets = list(client.list_buckets(max_results=1))
    print(f"ğŸ”“ é€£ç·šæˆåŠŸï¼Œå·²ç²å– Cloud Storage å­˜å–æ¬Šé™")
else:
    print(f"âŒ æ‰¾ä¸åˆ°æ†‘è­‰ï¼Œè«‹é‡æ–°åŸ·è¡Œ gcloud auth application-default login")
```

## å¸¸è¦‹å•é¡Œ Q&A

### Q1ï¼šæˆ‘åŸ·è¡Œäº† `gcloud auth login` ä½†ç¨‹å¼é‚„æ˜¯èªªæ‰¾ä¸åˆ°æ†‘è­‰ï¼Ÿ

**ç­”ï¼š** é€™æ˜¯æœ€å¸¸è¦‹çš„èª¤å€ã€‚`gcloud auth login` æ˜¯çµ¦ CLI ç”¨çš„ï¼›ç¨‹å¼ SDK éœ€è¦çš„æ˜¯ `gcloud auth application-default login` æ‰€ç”¢ç”Ÿçš„æ†‘è­‰æª”æ¡ˆã€‚**å…©è€…ä¸äº’é€šã€‚**

### Q2ï¼šåˆ‡æ›å°ˆæ¡ˆæ™‚éœ€è¦é‡æ–°åŸ·è¡Œå—ï¼Ÿ

**ç­”ï¼š** æœ€å¥½é‡æ–°åŸ·è¡Œä¸€æ¬¡ã€‚é›–ç„¶ ADC æ†‘è­‰æœ¬èº«ä¸å¼·ç¶å®šå°ˆæ¡ˆï¼Œä½†æ˜ç¢ºè¨­å®š `gcloud config set project` ä¸¦é‡æ–° login å¯ä»¥ç¢ºä¿ `default()` ç²å–åˆ°çš„ Project ID æ˜¯æ­£ç¢ºçš„ã€‚

### Q3ï¼šåŸ·è¡Œ `gcloud auth application-default login` æ™‚ï¼Œç€è¦½å™¨è·³å‡ºçš„æˆæ¬Šç•«é¢è¦å‹¾é¸å“ªäº›æ¬Šé™ï¼Ÿ

**ç­”ï¼š** å»ºè­° **å…¨éƒ¨å‹¾é¸ (Select all)**ã€‚å¸¸è¦‹æœƒçœ‹åˆ°ï¼š

- ã€ŒSee, edit, configure, and delete your Google Cloud data...ã€ï¼ˆcloud-platform scopeï¼‰
- ã€ŒView and sign in to your Google Cloud SQL instancesã€

é€™äº›ç¯„åœ (scopes) å®šç¾©çš„æ˜¯ã€Œé€™çµ„æ†‘è­‰æœ€å¤šèƒ½ä»£ç†å“ªäº›å‹•ä½œã€ï¼Œä½†**å¯¦éš›èƒ½å¦å­˜å–è³‡æºï¼Œä»ç”± GCP IAM è§’è‰²æ§åˆ¶**ã€‚æ›å¥è©±èªªï¼š

1. **æˆæ¬Šç•«é¢ = å®šç¾©ä¸Šé™**ï¼šè®“æœ¬åœ°ç¨‹å¼ç¢¼ã€Œæœ‰è³‡æ ¼ã€å‘¼å«é€™äº› APIã€‚
2. **IAM è§’è‰² = å¯¦éš›æ¬Šé™**ï¼šå³ä½¿ scope å…è¨±ï¼Œè‹¥æ‚¨åœ¨å°ˆæ¡ˆä¸­æ²’æœ‰å°æ‡‰è§’è‰²ï¼ˆå¦‚ Firestore Adminï¼‰ï¼Œæ“ä½œä»æœƒè¢« GCP æ‹’çµ•ã€‚

æ†‘è­‰åªå­˜æ–¼æœ¬åœ° `%APPDATA%\gcloud\application_default_credentials.json`ï¼Œä¸æœƒä¸Šå‚³ä»»ä½•åœ°æ–¹ï¼Œå› æ­¤å®‰å…¨ç„¡è™ã€‚

## é‡é»æ•´ç†

| å‘½ä»¤                                    | é©ç”¨å°è±¡               | æœ¬åœ°å„²å­˜è·¯å¾‘                               |
| --------------------------------------- | ---------------------- | ------------------------------------------ |
| `gcloud auth login`                     | `gcloud` æŒ‡ä»¤å·¥å…·      | `~/.config/gcloud/credentials.db`          |
| `gcloud auth application-default login` | Python / Node / Go SDK | `.../application_default_credentials.json` |

---

## åƒè€ƒç¨‹å¼ç¢¼ä¾†æº

| æª”æ¡ˆè·¯å¾‘                                                  | èªªæ˜                         |
| --------------------------------------------------------- | ---------------------------- |
| `docs/development-guide/guide--03-migrate-to-real-gcp.md` | æœ¬åœ°é·ç§»æŒ‡å— Step 3 æœ¬åœ°é©—è­‰ |

---

[â¬…ï¸ è¿”å› Google Cloud èº«èº«åˆ†é©—è­‰ ç´¢å¼•](./index.md)
