# 合規性與資料保存 (Compliance & Retention)

## 關鍵字

- **Versioning (版本控制)**：保留物件歷史版本，防止意外刪除或未授權的修改。
- **Bucket Lock (物件保留政策)**：確保物件在指定時間內「絕對無法被刪除」。
- **Audit Trail (稽核軌跡)**：證明資料在特定時間點的內容與變更紀錄。

## 針對醫療器材 (ISO 13485 / FDA 21 CFR Part 11) 的應用

如果您建構的是**醫療器材法規文件管理平台**，資料的**完整性 (Integrity)** 與**可追溯性 (Traceability)** 是核心要求。

### 1. 為什麼一定要開啟 Versioning？

在法規環境中，你必須能夠回答：_「這份文件在去年 10 月 5 日被核准時，具體的內容是什麼？」_

- **防篡改**：即使有人「覆蓋」了檔案，GCS 的 Versioning 會將舊版本存為一個具有唯一版本 ID 的物件，確保原始核准版本依然存在且可被讀取。
- **合規性要求**：許多法規要求必須保留修改紀錄。GCS Versioning 提供了「儲存層」的最強物理保證。

### 2. 進階保護：Bucket Lock (Object Retention)

對於已歸檔 (Archived) 的技術文件或臨床報告，僅靠 Versioning 可能不夠。

- **情境**：如果擁有管理者權限的人意外刪除整個 Bucket 或所有版本，資料依然會消失。
- **解決方案**：開啟 **Retention Policy**（例如設定 10 年）。
  - 在這 10 年內，**任何人（包括管理員與 Google 本身）**都無法刪除這些物件。
  - 這符合「電子紀錄保存」的法律效力。

### 3. 架構設計建議：兩層式版本管理

| 層級                 | 實施方式                  | 目的                                                                                                      |
| :------------------- | :------------------------ | :-------------------------------------------------------------------------------------------------------- |
| **儲存層 (GCS)**     | 開啟 Versioning           | **底層安全網**。防止意外遺失，提供不可否認性。                                                            |
| **應用層 (Backend)** | Firestore 紀錄 version_id | **稽核軌跡 (Audit Trail)**。紀錄是「誰 (Who)」、在「何時 (When)」、為了「什麼原因 (Why)」上傳了這個版本。 |

> [!IMPORTANT] > **結論：針對醫材法規平台，Versioning 是「必須」開啟的。**
> 雖然它會增加儲存費用，但在法規稽查 (Audit) 時，這筆費用遠比「無法提供原始文件紀錄」的風險與罰款要低得多。

## 資料駐留 (Data Residency) 與法規限制

針對醫材平台，資料儲存的「物理地點」往往是稽核重點。

### 1. 物理國界的要求

- **本地法律 (如台灣個資法)**：雖然個資法未禁止跨境，但多數台灣醫療機構標案會要求**「資料不離境」**。
- **GCS 的優勢**：可精確指定為 `asia-east1` (台北)，確保資料實體位在台灣境內。
- **Cloudflare R2 的侷限**：R2 以全球加速為目的，雖然支援「轄區控制 (Jurisdictions)」可限制在美國 (US) 或歐盟 (EU)，但無法細化到「僅限台灣」。

### 2. GCS vs. Cloudflare R2 合規性比較

| 特性             | Google Cloud Storage (GCS)               | Cloudflare R2                             |
| :--------------- | :--------------------------------------- | :---------------------------------------- |
| **地區精確度**   | **高** (可選特定城市台、日、美)          | **中** (僅限轄區 US/EU 或全球自動)        |
| **醫材合規建議** | **首選**。適合有「資料駐留」要求的標案。 | 適合**全球化銷售產品** (節省出口流量費)。 |
| **Versioning**   | 支援                                     | 支援                                      |
| **主要優勢**     | 容易通過台灣本地資安查核。               | 零出口流量費 (Egress Free)。              |

> [!IMPORTANT] > **醫材開發決策建議**：
> 如果您的第一步是服務台灣醫療機構，建議維持使用 **GCP `asia-east1`**，這是最容易通過資安審查的配置。未來若要進軍歐美市場並優化成本，再考慮遷移至 Cloudflare R2 並設定對應的轄區控制。

## 延伸閱讀

- [GCP Retention Policy 官方說明](https://cloud.google.com/storage/docs/bucket-lock)
- [FDA 21 CFR Part 11 簡介](https://www.fda.gov/regulatory-information/search-fda-guidance-documents/part-11-electronic-records-electronic-signatures-scope-and-application)
