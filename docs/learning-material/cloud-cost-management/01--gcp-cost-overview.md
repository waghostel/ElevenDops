# GCP æœå‹™æˆæœ¬æ¦‚è¦½

## é—œéµå­—

- **Pay-as-you-go**ï¼šæŒ‰ä½¿ç”¨é‡ä»˜è²»çš„è¨ˆè²»æ¨¡å¼
- **Free Tier**ï¼šGCP æä¾›çš„å…è²»é¡åº¦ï¼Œæ¯æœˆè‡ªå‹•é‡ç½®
- **vCPU-second**ï¼šCPU ä½¿ç”¨æ™‚é–“çš„è¨ˆé‡å–®ä½
- **GiB-second**ï¼šè¨˜æ†¶é«”ä½¿ç”¨æ™‚é–“çš„è¨ˆé‡å–®ä½
- **Egress**ï¼šå¾ GCP å‚³å‡ºè³‡æ–™çš„æµé‡è²»ç”¨

## å­¸ç¿’ç›®æ¨™

å®Œæˆæœ¬ç« ç¯€å¾Œï¼Œæ‚¨å°‡èƒ½å¤ ï¼š

1. äº†è§£ ElevenDops å°ˆæ¡ˆä¸­å„é … GCP æœå‹™çš„è¨ˆè²»æ–¹å¼
2. ä¼°ç®—æ¯æœˆå¯èƒ½ç”¢ç”Ÿçš„ GCP è²»ç”¨
3. è­˜åˆ¥å“ªäº›æ“ä½œæœƒç”¢ç”Ÿè²»ç”¨

---

## Cloud Run

### æˆ‘å€‘åœ¨åšä»€éº¼ï¼Ÿ

Cloud Run æ˜¯å°ˆæ¡ˆçš„ä¸»è¦æ‡‰ç”¨ç¨‹å¼éƒ¨ç½²å¹³å°ï¼Œé‹è¡Œ FastAPI å¾Œç«¯å’Œ Streamlit å‰ç«¯ã€‚

### è¨ˆè²»é …ç›®

```mermaid
flowchart LR
    subgraph è¨ˆè²»é …ç›®
        CPU[vCPU ä½¿ç”¨æ™‚é–“]
        MEM[è¨˜æ†¶é«”ä½¿ç”¨æ™‚é–“]
        REQ[è«‹æ±‚æ•¸é‡]
        NET[ç¶²è·¯å‡ºç«™æµé‡]
    end

    CPU --> |$0.000024/ç§’| è²»ç”¨
    MEM --> |$0.0000025/GiB-ç§’| è²»ç”¨
    REQ --> |$0.40/ç™¾è¬| è²»ç”¨
    NET --> |$0.12/GB| è²»ç”¨
```

### å®šåƒ¹è©³æƒ…ï¼ˆTier 1 å€åŸŸï¼‰

| é …ç›®     | å…è²»é¡åº¦/æœˆ     | è¶…å‡ºè²»ç”¨          |
| -------- | --------------- | ----------------- |
| vCPU     | 180,000 vCPU-ç§’ | $0.000024/vCPU-ç§’ |
| è¨˜æ†¶é«”   | 360,000 GiB-ç§’  | $0.0000025/GiB-ç§’ |
| è«‹æ±‚æ•¸   | 2,000,000 æ¬¡    | $0.40/ç™¾è¬è«‹æ±‚    |
| ç¶²è·¯å‡ºç«™ | 1 GiB           | $0.12/GiB         |

### è²»ç”¨ä¼°ç®—ç¯„ä¾‹

å‡è¨­æ¯æœˆæœ‰ 10,000 æ¬¡ API å‘¼å«ï¼Œæ¯æ¬¡å‘¼å«å¹³å‡åŸ·è¡Œ 2 ç§’ï¼š

```
# å‡è¨­é…ç½®ï¼š2 vCPUã€1 GiB è¨˜æ†¶é«”

vCPU ä½¿ç”¨é‡ = 10,000 Ã— 2ç§’ Ã— 2vCPU = 40,000 vCPU-ç§’
è¨˜æ†¶é«”ä½¿ç”¨é‡ = 10,000 Ã— 2ç§’ Ã— 1GiB = 20,000 GiB-ç§’

# å…©è€…éƒ½åœ¨å…è²»é¡åº¦å…§ï¼Œè²»ç”¨ = $0
```

### æˆæœ¬æ§åˆ¶é—œéµ

> [!IMPORTANT]
> å°ˆæ¡ˆè¨­å®š `min-instances: 0`ï¼Œé€™æ„å‘³è‘—ï¼š
>
> - âœ… æ²’æœ‰è«‹æ±‚æ™‚ä¸æ”¶è²»
> - âš ï¸ å†·å•Ÿå‹•å»¶é²è¼ƒé«˜
> - ğŸ’¡ é©åˆé–‹ç™¼å’Œä½æµé‡å ´æ™¯

---

## Cloud Build

### æˆ‘å€‘åœ¨åšä»€éº¼ï¼Ÿ

Cloud Build è² è²¬ CI/CD æµç¨‹ï¼Œæ¯æ¬¡æ¨é€åˆ° main åˆ†æ”¯æ™‚è‡ªå‹•å»ºç½®å’Œéƒ¨ç½²å®¹å™¨æ˜ åƒã€‚

### å®šåƒ¹è©³æƒ…

| æ©Ÿå™¨é¡å‹      | å…è²»é¡åº¦/æœˆ | è¶…å‡ºè²»ç”¨    |
| ------------- | ----------- | ----------- |
| e2-standard-2 | 2,500 åˆ†é˜  | $0.006/åˆ†é˜ |
| e2-highcpu-8  | -           | $0.016/åˆ†é˜ |

### å°ˆæ¡ˆé…ç½®åˆ†æ

å¾ `cloudbuild.yaml` å¯è¦‹ï¼š

```yaml
options:
  machineType: "E2_HIGHCPU_8" # ä½¿ç”¨è¼ƒå¿«çš„æ©Ÿå™¨
timeout: "900s" # æœ€é•· 15 åˆ†é˜
```

### è²»ç”¨ä¼°ç®—ç¯„ä¾‹

```
# å‡è¨­æ¯é€±éƒ¨ç½² 5 æ¬¡ï¼Œæ¯æ¬¡å»ºç½®ç´„ 5 åˆ†é˜

æ¯æœˆå»ºç½®åˆ†é˜ = 5æ¬¡/é€± Ã— 4é€± Ã— 5åˆ†é˜ = 100 åˆ†é˜
è²»ç”¨ = 100 Ã— $0.016 = $1.60/æœˆ
```

> [!TIP]
> å¦‚æœå»ºç½®æ™‚é–“å…è¨±ï¼Œæ”¹ç”¨ `e2-standard-2` å¯äº«å—å…è²»é¡åº¦ã€‚

---

## Artifact Registry

### æˆ‘å€‘åœ¨åšä»€éº¼ï¼Ÿ

Artifact Registry å„²å­˜ Docker å®¹å™¨æ˜ åƒï¼Œæ¯æ¬¡å»ºç½®ç”¢ç”Ÿæ–°çš„æ˜ åƒç‰ˆæœ¬ã€‚

### å®šåƒ¹è©³æƒ…

| é …ç›®     | å…è²»é¡åº¦ | è¶…å‡ºè²»ç”¨    |
| -------- | -------- | ----------- |
| å„²å­˜ç©ºé–“ | 0.5 GB   | $0.10/GB/æœˆ |

### è²»ç”¨é¢¨éšª

> [!CAUTION]
> Docker æ˜ åƒå¾ˆå®¹æ˜“è¶…é 0.5 GBï¼å…¸å‹çš„ Python æ‡‰ç”¨æ˜ åƒç´„ 500MB - 1GBã€‚å¦‚æœä¿ç•™å¤šå€‹ç‰ˆæœ¬ï¼Œå„²å­˜è²»ç”¨æœƒå¿«é€Ÿç´¯ç©ã€‚

### è²»ç”¨ä¼°ç®—ç¯„ä¾‹

```
# å‡è¨­æ¯å€‹æ˜ åƒ 800 MBï¼Œä¿ç•™æœ€è¿‘ 10 å€‹ç‰ˆæœ¬

ç¸½å„²å­˜ = 0.8 GB Ã— 10 = 8 GB
è¶…å‡ºå…è²»é¡åº¦ = 8 - 0.5 = 7.5 GB
è²»ç”¨ = 7.5 Ã— $0.10 = $0.75/æœˆ
```

### æˆæœ¬æ§åˆ¶ç­–ç•¥

åƒè€ƒ [Artifact Registry æ¸…ç†ç­–ç•¥](../artifact-registry/03--cleanup-policies.md) è¨­å®šè‡ªå‹•æ¸…ç†èˆŠæ˜ åƒã€‚

---

## Cloud Storage (GCS)

### æˆ‘å€‘åœ¨åšä»€éº¼ï¼Ÿ

GCS å„²å­˜ ElevenLabs ç”Ÿæˆçš„éŸ³è¨Šæª”æ¡ˆï¼ˆMP3 æ ¼å¼ï¼‰ã€‚

### å®šåƒ¹è©³æƒ…ï¼ˆStandard Storageï¼‰

| é …ç›®                 | å…è²»é¡åº¦  | è²»ç”¨ï¼ˆç¾åœ‹å€åŸŸï¼‰ |
| -------------------- | --------- | ---------------- |
| å„²å­˜ç©ºé–“             | 5 GB      | $0.020/GB/æœˆ     |
| Class A æ“ä½œï¼ˆå¯«å…¥ï¼‰ | 5,000 æ¬¡  | $0.05/10,000 æ¬¡  |
| Class B æ“ä½œï¼ˆè®€å–ï¼‰ | 50,000 æ¬¡ | $0.004/10,000 æ¬¡ |
| ç¶²è·¯å‡ºç«™             | 1 GB      | $0.12/GB         |

### è²»ç”¨ä¼°ç®—ç¯„ä¾‹

```
# å‡è¨­æ¯æœˆç”Ÿæˆ 500 å€‹éŸ³è¨Šæª”æ¡ˆï¼Œæ¯å€‹ç´„ 500 KB

å„²å­˜é‡ = 500 Ã— 0.5 MB = 250 MB = 0.25 GB
å¯«å…¥æ“ä½œ = 500 æ¬¡
è®€å–æ“ä½œ = å‡è¨­ 1,500 æ¬¡

# å…¨éƒ¨åœ¨å…è²»é¡åº¦å…§ï¼Œè²»ç”¨ = $0
```

> [!NOTE]
> éŸ³è¨Šæª”æ¡ˆé€šå¸¸è¼ƒå°ï¼ˆ1-5 MBï¼‰ï¼Œå°æ–¼å°å‹å°ˆæ¡ˆï¼ŒGCS æˆæœ¬å¯å¿½ç•¥ä¸è¨ˆã€‚

---

## Firestore

### æˆ‘å€‘åœ¨åšä»€éº¼ï¼Ÿ

Firestore å„²å­˜æ‰€æœ‰æ‡‰ç”¨ç¨‹å¼è³‡æ–™ï¼ŒåŒ…æ‹¬ï¼š

- çŸ¥è­˜åº«æ–‡ä»¶ (`knowledge_documents`)
- éŸ³è¨Šæª”æ¡ˆå…ƒè³‡æ–™ (`audio_files`)
- AI ä»£ç†é…ç½® (`agents`)
- å°è©±è¨˜éŒ„ (`conversations`)
- ç—…æ‚£æœƒè©± (`patient_sessions`)

### å®šåƒ¹è©³æƒ…ï¼ˆNative Modeï¼‰

| æ“ä½œé¡å‹ | å…è²»é¡åº¦/å¤© | è¶…å‡ºè²»ç”¨         |
| -------- | ----------- | ---------------- |
| æ–‡ä»¶è®€å– | 50,000 æ¬¡   | $0.03/100,000 æ¬¡ |
| æ–‡ä»¶å¯«å…¥ | 20,000 æ¬¡   | $0.09/100,000 æ¬¡ |
| æ–‡ä»¶åˆªé™¤ | 20,000 æ¬¡   | $0.01/100,000 æ¬¡ |
| å„²å­˜ç©ºé–“ | 1 GiB       | $0.15/GiB/æœˆ     |

### è¨ˆè²»æ³¨æ„äº‹é …

> [!WARNING] > **è®€å–è²»ç”¨æŒ‰ 4 KB è¨ˆç®—**
>
> å¦‚æœæ–‡ä»¶å¤§æ–¼ 4 KBï¼Œæ¯ 4 KB æœƒè¨ˆç‚ºä¸€æ¬¡è®€å–æ“ä½œã€‚
> ä¾‹å¦‚ï¼šè®€å–ä¸€å€‹ 10 KB æ–‡ä»¶ = 3 æ¬¡è®€å–æ“ä½œï¼ˆ10/4 = 2.5ï¼Œé€²ä½ç‚º 3ï¼‰

### è²»ç”¨ä¼°ç®—ç¯„ä¾‹

```
# å‡è¨­æ¯å¤©ï¼š
# - è®€å– 10,000 æ¬¡å„€è¡¨æ¿è³‡æ–™
# - å¯«å…¥ 1,000 æ¬¡ä½¿ç”¨è€…æ“ä½œ
# - å„²å­˜ 500 MB è³‡æ–™

è®€å–ï¼š10,000/å¤© < 50,000 å…è²»é¡åº¦ âœ…
å¯«å…¥ï¼š1,000/å¤© < 20,000 å…è²»é¡åº¦ âœ…
å„²å­˜ï¼š500 MB < 1 GiB å…è²»é¡åº¦ âœ…

è²»ç”¨ = $0
```

---

## Secret Manager

### æˆ‘å€‘åœ¨åšä»€éº¼ï¼Ÿ

Secret Manager å®‰å…¨å„²å­˜æ•æ„Ÿè³‡è¨Šï¼š

- `elevenlabs-api-key`
- `google-api-key`
- `langsmith-api-key`

### å®šåƒ¹è©³æƒ…

| é …ç›®         | å…è²»é¡åº¦/æœˆ | è¶…å‡ºè²»ç”¨        |
| ------------ | ----------- | --------------- |
| æ´»èºå¯†é‘°ç‰ˆæœ¬ | 6 å€‹        | $0.06/ç‰ˆæœ¬/æœˆ   |
| å­˜å–æ“ä½œ     | 10,000 æ¬¡   | $0.03/10,000 æ¬¡ |

### è²»ç”¨ä¼°ç®—ç¯„ä¾‹

```
# å°ˆæ¡ˆæœ‰ 3 å€‹å¯†é‘°ï¼Œæ¯å€‹ 1 å€‹ç‰ˆæœ¬

æ´»èºç‰ˆæœ¬ = 3 < 6 å…è²»é¡åº¦ âœ…

# å‡è¨­æ¯æ¬¡ Cloud Run å†·å•Ÿå‹•è®€å– 3 å€‹å¯†é‘°
# æ¯æœˆ 1,000 æ¬¡å†·å•Ÿå‹•

å­˜å–æ¬¡æ•¸ = 1,000 Ã— 3 = 3,000 < 10,000 å…è²»é¡åº¦ âœ…

è²»ç”¨ = $0
```

> [!TIP]
> Secret Manager å°æ–¼å°å‹å°ˆæ¡ˆå¹¾ä¹å…è²»ï¼Œæ˜¯ç®¡ç† API é‡‘é‘°çš„ç†æƒ³é¸æ“‡ã€‚

---

## å¸¸è¦‹å•é¡Œ Q&A

### Q1ï¼šå“ªå€‹ GCP æœå‹™æœ€å¯èƒ½ç”¢ç”Ÿè²»ç”¨ï¼Ÿ

**ç­”ï¼š** å°æ–¼ ElevenDops å°ˆæ¡ˆï¼Œæœ€å¯èƒ½ç”¢ç”Ÿè²»ç”¨çš„æ˜¯ï¼š

1. **Cloud Run** - å¦‚æœæµé‡å¢åŠ æˆ–è¨­å®š `min-instances > 0`
2. **Artifact Registry** - å¦‚æœæ²’æœ‰è¨­å®šæ¸…ç†ç­–ç•¥ï¼Œæ˜ åƒæœƒæŒçºŒç´¯ç©
3. **Cloud Storage** - å¦‚æœéŸ³è¨Šæª”æ¡ˆå¤§é‡ç´¯ç©ä¸”æ²’æœ‰æ¸…ç†

### Q2ï¼šå¦‚ä½•æŸ¥çœ‹ç›®å‰çš„ GCP è²»ç”¨ï¼Ÿ

**ç­”ï¼š** åœ¨ GCP Console ä¸­ï¼š

1. å‰å¾€ **Billing** > **Reports**
2. é¸æ“‡å°ˆæ¡ˆå’Œæ™‚é–“ç¯„åœ
3. æŒ‰æœå‹™åˆ†çµ„æŸ¥çœ‹è²»ç”¨ç´°é …

### Q3ï¼šå…è²»é¡åº¦æ˜¯æ¯å€‹å°ˆæ¡ˆé‚„æ˜¯æ¯å€‹å¸³æˆ¶ï¼Ÿ

**ç­”ï¼š** å¤§éƒ¨åˆ† GCP æœå‹™çš„å…è²»é¡åº¦æ˜¯**æŒ‰è¨ˆè²»å¸³æˆ¶ï¼ˆBilling Accountï¼‰è¨ˆç®—**ï¼Œè€ŒéæŒ‰å°ˆæ¡ˆã€‚å¦‚æœå¤šå€‹å°ˆæ¡ˆå…±ç”¨åŒä¸€å€‹è¨ˆè²»å¸³æˆ¶ï¼Œå…è²»é¡åº¦æœƒå…±äº«ã€‚

---

## é‡é»æ•´ç†

| GCP æœå‹™          | ä¸»è¦è¨ˆè²»é …ç›®       | å°å‹å°ˆæ¡ˆé ä¼° | æˆæœ¬é¢¨éšªç­‰ç´š |
| ----------------- | ------------------ | ------------ | ------------ |
| Cloud Run         | vCPUã€è¨˜æ†¶é«”ã€è«‹æ±‚ | å…è²»é¡åº¦å…§   | â­â­ ä¸­      |
| Cloud Build       | å»ºç½®åˆ†é˜           | $0-5/æœˆ      | â­ ä½        |
| Artifact Registry | å„²å­˜ç©ºé–“           | $0-5/æœˆ      | â­â­ ä¸­      |
| Cloud Storage     | å„²å­˜ã€æµé‡         | å…è²»é¡åº¦å…§   | â­ ä½        |
| Firestore         | è®€/å¯«æ“ä½œã€å„²å­˜    | å…è²»é¡åº¦å…§   | â­â­ ä¸­      |
| Secret Manager    | ç‰ˆæœ¬ã€å­˜å–æ¬¡æ•¸     | å…è²»         | â­ æ¥µä½      |

---

## å»¶ä¼¸é–±è®€

- [Cloud Run Pricing](https://cloud.google.com/run/pricing)
- [Cloud Build Pricing](https://cloud.google.com/build/pricing)
- [Artifact Registry Pricing](https://cloud.google.com/artifact-registry/pricing)
- [Cloud Storage Pricing](https://cloud.google.com/storage/pricing)
- [Firestore Pricing](https://cloud.google.com/firestore/pricing)
- [Secret Manager Pricing](https://cloud.google.com/secret-manager/pricing)

---

## åƒè€ƒç¨‹å¼ç¢¼ä¾†æº

æœ¬æ–‡ä»¶ä¸­çš„åˆ†æåƒè€ƒè‡ªä»¥ä¸‹å°ˆæ¡ˆæª”æ¡ˆï¼š

| æª”æ¡ˆè·¯å¾‘                                     | èªªæ˜                                       |
| -------------------------------------------- | ------------------------------------------ |
| `cloudbuild.yaml`                            | Cloud Build é…ç½®ï¼ŒåŒ…å«æ©Ÿå™¨é¡å‹å’Œå»ºç½®æ­¥é©Ÿ   |
| `backend/config.py`                          | æ‡‰ç”¨ç¨‹å¼é…ç½®ï¼ŒåŒ…å« Secret Manager å¯†é‘°åç¨± |
| `backend/services/storage_service.py`        | GCS å„²å­˜æœå‹™å¯¦ä½œ                           |
| `backend/services/firestore_data_service.py` | Firestore è³‡æ–™å­˜å–æœå‹™                     |

---

[â¬…ï¸ è¿”å› é›²ç«¯æˆæœ¬ç®¡æ§ ç´¢å¼•](./index.md)
