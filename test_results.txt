============================= test session starts =============================
platform win32 -- Python 3.11.0, pytest-9.0.2, pluggy-1.6.0
rootdir: C:\Users\Cheney\Documents\Github\ElevenDops
configfile: pyproject.toml
plugins: anyio-4.12.0, hypothesis-6.148.8, langsmith-0.5.1, asyncio-1.3.0
asyncio: mode=Mode.AUTO, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collected 14 items

tests\test_frontend_api_props.py .                                       [  7%]
tests\test_script_generation_frontend_props.py FF                        [ 21%]
tests\test_education_audio_integration.py FFFF                           [ 50%]
tests\properties\test_frontend_api_props.py .                            [ 57%]
tests\properties\test_frontend_conversation_props.py ..                  [ 71%]
tests\properties\test_frontend_patient_props.py .                        [ 78%]
tests\properties\test_patient_page_props.py ..s                          [100%]

================================== FAILURES ===================================
_______________________ test_configuration_persistence ________________________

mock_client = <MagicMock id='1734511723088'>

    def test_configuration_persistence(mock_client):
        """Property 1: Configuration Persistence."""
        with patch("streamlit_app.services.backend_api.get_backend_client", return_value=mock_client):
            at = AppTest.from_file("streamlit_app/pages/3_Education_Audio.py", default_timeout=30)
            at.session_state["IS_TESTING_BACKEND"] = True
            at.run()
    
            # Verify default model is gemini-2.5-flash-lite (per index=1 default)
    
            # Select document first to show script editor
>           at.selectbox[0].select_index(0).run()
            ^^^^^^^^^^^^^^^

tests\test_script_generation_frontend_props.py:63: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = WidgetList(), idx = 0

    def __getitem__(self, idx: int | slice) -> El_co | ElementList[El_co]:
        if isinstance(idx, slice):
            return ElementList(self._list[idx])
>       return self._list[idx]
               ^^^^^^^^^^^^^^^
E       IndexError: list index out of range

.venv\Lib\site-packages\streamlit\testing\v1\element_tree.py:228: IndexError
---------------------------- Captured stderr call -----------------------------
2025-12-29 21:58:28.153 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
2025-12-29 21:58:28.153 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
______________________ test_script_generation_parameters ______________________

mock_client = <MagicMock id='1734655522384'>

    def test_script_generation_parameters(mock_client):
        """Verify parameters passed to backend."""
        with patch("streamlit_app.services.backend_api.get_backend_client", return_value=mock_client):
            at = AppTest.from_file("streamlit_app/pages/3_Education_Audio.py", default_timeout=30)
            at.session_state["IS_TESTING_BACKEND"] = True
            at.run()
    
            # Select Doc
>           at.selectbox[0].select_index(0).run()
            ^^^^^^^^^^^^^^^

tests\test_script_generation_frontend_props.py:85: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = WidgetList(), idx = 0

    def __getitem__(self, idx: int | slice) -> El_co | ElementList[El_co]:
        if isinstance(idx, slice):
            return ElementList(self._list[idx])
>       return self._list[idx]
               ^^^^^^^^^^^^^^^
E       IndexError: list index out of range

.venv\Lib\site-packages\streamlit\testing\v1\element_tree.py:228: IndexError
---------------------------- Captured stderr call -----------------------------
2025-12-29 21:58:29.096 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
2025-12-29 21:58:29.097 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
___________________ test_page_loads_and_displays_documents ____________________

mock_client = <MagicMock id='1734656450000'>

    def test_page_loads_and_displays_documents(mock_client):
        """Test that the page loads and fetches documents."""
        with patch("streamlit_app.services.backend_api.get_backend_client", return_value=mock_client):
            at = AppTest.from_file("streamlit_app/pages/3_Education_Audio.py", default_timeout=30)
            at.session_state["IS_TESTING_BACKEND"] = True
            at.run()
    
            assert not at.exception
            # Check title
            assert "Patient Education Audio" in at.title[0].value
            # Check document selector options matches mockup
>           assert "Flu" in at.selectbox[0].options
                            ^^^^^^^^^^^^^^^

tests\test_education_audio_integration.py:82: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = WidgetList(), idx = 0

    def __getitem__(self, idx: int | slice) -> El_co | ElementList[El_co]:
        if isinstance(idx, slice):
            return ElementList(self._list[idx])
>       return self._list[idx]
               ^^^^^^^^^^^^^^^
E       IndexError: list index out of range

.venv\Lib\site-packages\streamlit\testing\v1\element_tree.py:228: IndexError
---------------------------- Captured stderr call -----------------------------
2025-12-29 21:58:29.218 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
2025-12-29 21:58:29.218 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
_________________________ test_script_generation_flow _________________________

mock_client = <MagicMock id='1734517577040'>

    def test_script_generation_flow(mock_client):
        """Test selecting a document and generating a script."""
        with patch("streamlit_app.services.backend_api.get_backend_client", return_value=mock_client):
            at = AppTest.from_file("streamlit_app/pages/3_Education_Audio.py", default_timeout=30)
            at.session_state["IS_TESTING_BACKEND"] = True
            at.run()
    
            # Select document "Flu" at index 0
>           at.selectbox[0].select_index(0).run()
            ^^^^^^^^^^^^^^^

tests\test_education_audio_integration.py:92: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = WidgetList(), idx = 0

    def __getitem__(self, idx: int | slice) -> El_co | ElementList[El_co]:
        if isinstance(idx, slice):
            return ElementList(self._list[idx])
>       return self._list[idx]
               ^^^^^^^^^^^^^^^
E       IndexError: list index out of range

.venv\Lib\site-packages\streamlit\testing\v1\element_tree.py:228: IndexError
---------------------------- Captured stderr call -----------------------------
2025-12-29 21:58:29.378 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
2025-12-29 21:58:29.378 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
_________________________ test_audio_generation_flow __________________________

mock_client = <MagicMock id='1734655836752'>

    def test_audio_generation_flow(mock_client):
        """Test selecting a voice and generating audio."""
        with patch("streamlit_app.services.backend_api.get_backend_client", return_value=mock_client):
            at = AppTest.from_file("streamlit_app/pages/3_Education_Audio.py", default_timeout=30)
            at.session_state["IS_TESTING_BACKEND"] = True
            at.run()
    
            # 1. Select Document
>           at.selectbox[0].select_index(0).run()
            ^^^^^^^^^^^^^^^

tests\test_education_audio_integration.py:121: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = WidgetList(), idx = 0

    def __getitem__(self, idx: int | slice) -> El_co | ElementList[El_co]:
        if isinstance(idx, slice):
            return ElementList(self._list[idx])
>       return self._list[idx]
               ^^^^^^^^^^^^^^^
E       IndexError: list index out of range

.venv\Lib\site-packages\streamlit\testing\v1\element_tree.py:228: IndexError
---------------------------- Captured stderr call -----------------------------
2025-12-29 21:58:29.499 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
2025-12-29 21:58:29.499 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
________________________ test_reset_on_document_change ________________________

mock_client = <MagicMock id='1734655362448'>

    def test_reset_on_document_change(mock_client):
        """Test that state resets when document selection changes."""
        with patch("streamlit_app.services.backend_api.get_backend_client", return_value=mock_client):
            at = AppTest.from_file("streamlit_app/pages/3_Education_Audio.py", default_timeout=30)
            at.session_state["IS_TESTING_BACKEND"] = True
            at.run()
    
            # Setup initial state
>           at.selectbox[0].select_index(0).run()
            ^^^^^^^^^^^^^^^

tests\test_education_audio_integration.py:160: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = WidgetList(), idx = 0

    def __getitem__(self, idx: int | slice) -> El_co | ElementList[El_co]:
        if isinstance(idx, slice):
            return ElementList(self._list[idx])
>       return self._list[idx]
               ^^^^^^^^^^^^^^^
E       IndexError: list index out of range

.venv\Lib\site-packages\streamlit\testing\v1\element_tree.py:228: IndexError
---------------------------- Captured stderr call -----------------------------
2025-12-29 21:58:29.657 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
2025-12-29 21:58:29.657 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
============================== warnings summary ===============================
tests/test_script_generation_frontend_props.py::test_configuration_persistence
  C:\Users\Cheney\Documents\Github\ElevenDops\streamlit_app\pages\3_Education_Audio.py:130: RuntimeWarning: coroutine 'AsyncMockMixin._execute_mock_call' was never awaited
    return []
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ===========================
FAILED tests/test_script_generation_frontend_props.py::test_configuration_persistence
FAILED tests/test_script_generation_frontend_props.py::test_script_generation_parameters
FAILED tests/test_education_audio_integration.py::test_page_loads_and_displays_documents
FAILED tests/test_education_audio_integration.py::test_script_generation_flow
FAILED tests/test_education_audio_integration.py::test_audio_generation_flow
FAILED tests/test_education_audio_integration.py::test_reset_on_document_change
============= 6 failed, 7 passed, 1 skipped, 1 warning in 10.06s ==============
